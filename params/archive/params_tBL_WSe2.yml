# tBL_WSe2

exp_params:
  kv: 80  # kV
  conv_angle: 24.9 # mrad, semi-convergence angle
  Npix: 128 # Detector pixel number, EMPAD is 128. Only supports square detector for simplicity
  rbf: null # Pixels of radius of BF disk, used to calculate dk
  dx_spec: 0.1494 # Ang
  defocus: 0 # Ang, positive defocus here refers to actual underfocus or weaker lens strength following Kirkland/abtem/ptychoshelves convention
  c3: 0 # Ang, spherical aberration coefficients
  z_distance: 12 # Ang
  Nlayer: 1
  N_scans: 16384
  N_scan_slow: 128
  N_scan_fast: 128
  scan_step_size: 0.4290 # Ang
  scan_flipT: null # None for both 'simu' and loaded pos. Modify scan_flipT would change the image orientation. Expected input is [flipup, fliplr, transpose] just like PtychoShleves
  scan_affine: null # (scale, asymmetry, rotation, shear)
  scan_rand_std: 0.15 # None or scalar. Randomize the initial guess of scan position with Gaussian distributed displacement (std in px) to avoid raster grid pathology
  omode_max: 1
  omode_init_occu:
    occu_type: 'uniform'
    init_occu: null
  pmode_max: 16
  pmode_init_pows: [0.02]
  probe_permute: null
  meas_permute: null
  meas_reshape: null
  meas_flipT: [1, 0, 0] # Expected input is [flipup, fliplr, transpose] just like PtychoShleves
  meas_crop: null # None or (4,2) array-like for [[scan_slow_start, scan_slow_end], [scan_fast_start, scan_fast_end], [ky_start, ky_end], [kx_start, kx_end]]
  meas_resample: null # None or (2,1) array-like for [ky_zoom, kx_zoom]
  meas_add_source_size: null # None or a scalar of std (Ang)
  meas_add_detector_blur: null # None or a scalar of std (px)
  meas_add_poisson_noise: null # None or a scalar of electrons/Ang^2
  probe_simu_params: null

source_params:
  measurements_source: 'hdf5'
  measurements_params:
    path: 'data/tBL_WSe2/Fig_1h_24.9mrad_Themis/1/data_roi1_Ndp128_step128_dp.hdf5'
    key: 'dp'
  obj_source: 'simu'
  obj_params: null
  probe_source: 'simu'
  probe_params: null  
  pos_source: 'simu'
  pos_params: null
  tilt_source: 'simu'
  tilt_params:
    tilt_type: 'all'
    init_tilts: [[0, 0]]
  # obj_source: 'PtyRAD' 
  # obj_params: ptycho_output_path
  # probe_source: 'PtyRAD'
  # probe_params: ptycho_output_path 
  # pos_source: 'PtyRAD'
  # pos_params: ptycho_output_path
  # tilt_source: 'PtyRAD'
  # tilt_params: 'ptycho_output_path'
  # obj_source: 'PtyShv' 
  # obj_params: ptycho_output_path
  # probe_source: 'PtyShv'
  # probe_params: ptycho_output_path 
  # pos_source: 'PtyShv'
  # pos_params: ptycho_output_path
